(()=>{(()=>{const e={0:"Clear skies",1:"Mostly clear",2:"Partly cloudy",3:"Overcast",45:"Foggy",48:"Rime fog",51:"Light drizzle",53:"Moderate drizzle",55:"Heavy drizzle",56:"Light freezing drizzle",57:"Heavy freezing drizzle",61:"Light rain",63:"Moderate rain",65:"Heavy rain",66:"Light freezing rain",67:"Heavy freezing rain",71:"Light snow",73:"Moderate snow",75:"Heavy snow",77:"Snow grains",80:"Light rain showers",81:"Moderate rain showers",82:"Violent rain showers",85:"Light snow showers",86:"Heavy snow showers",95:"Thunderstorm",96:"Thunderstorm with hail",99:"Severe thunderstorm"},t=e=>{const t=typeof e=="string"?e.trim().toLowerCase():"";return t==="imperial"||t==="fahrenheit"||t==="f"?{temperatureUnit:"fahrenheit",symbol:"\xB0F"}:{temperatureUnit:"celsius",symbol:"\xB0C"}},n=t=>typeof t!="number"?"":e[t]||"",s=async e=>{if(!e||typeof fetch!="function")return null;const t=new URLSearchParams({name:e,count:"1"}),n=`https://geocoding-api.open-meteo.com/v1/search?${t.toString()}`;try{const s=await fetch(n,{method:"GET"});if(!s.ok)throw new Error(`Geocoding failed with status ${s.status}`);const o=await s.json(),t=Array.isArray(o?.results)?o.results[0]:null;if(!t)return null;const i=[t.name,t.admin1].filter(e=>typeof e=="string"&&e.trim().length>0).join(", ");return{latitude:typeof t.latitude=="number"?t.latitude:null,longitude:typeof t.longitude=="number"?t.longitude:null,displayName:i||e}}catch(e){console.warn("Weather geocoding failed",e)}return null},o=async({location:e,latitude:o,longitude:i,units:a})=>{if(typeof fetch!="function")return null;let r=Number.isFinite(o)?o:null,c=Number.isFinite(i)?i:null,l=e&&e.trim().length>0?e.trim():"";if((r===null||c===null)&&l){const e=await s(l);if(!e)return null;r=e.latitude,c=e.longitude,e.displayName&&(l=e.displayName)}if(r===null||c===null)return null;const{temperatureUnit:d,symbol:u}=t(a),h=new URLSearchParams({latitude:r.toFixed(4),longitude:c.toFixed(4),current:"temperature_2m,weather_code",temperature_unit:d,timezone:"auto"}),m=`https://api.open-meteo.com/v1/forecast?${h.toString()}`;try{const t=await fetch(m,{method:"GET"});if(!t.ok)throw new Error(`Weather request failed with status ${t.status}`);const s=await t.json(),e=s?.current;return!e||typeof e.temperature_2m!="number"?null:{locationName:l,temperature:e.temperature_2m,unitSymbol:u,description:n(typeof e.weather_code=="number"?e.weather_code:null)}}catch(e){console.warn("Weather request failed",e)}return null},i=()=>{if(typeof document=="undefined")return;const e=document.getElementById("nav-message-rotator");if(!e||e.dataset.weatherEnabled!=="true")return;if(e.querySelector('[data-weather-message="true"]'))return;const r=Array.from(e.querySelectorAll(".nav-module-message")),t=document.createElement("span");t.className="nav-module-message",t.dataset.index=String(r.length),t.dataset.weatherMessage="true";const n=typeof e.dataset.weatherLabel=="string"&&e.dataset.weatherLabel.trim().length>0?e.dataset.weatherLabel.trim():"";if(n){t.dataset.label=n;const e=document.createElement("span");e.className="nav-module-label",e.textContent=n,t.appendChild(e)}const s=document.createElement("span");s.className="nav-module-text",s.textContent="Loading weatherâ€¦",t.appendChild(s),r.length||t.classList.add("is-active"),e.appendChild(t);const c=parseFloat(e.dataset.weatherLatitude||""),l=parseFloat(e.dataset.weatherLongitude||""),d=Number.isFinite(c)?c:null,u=Number.isFinite(l)?l:null,a=typeof e.dataset.weatherLocation=="string"?e.dataset.weatherLocation:"",h=typeof e.dataset.weatherUnits=="string"?e.dataset.weatherUnits:"",i=n||(a?`Weather for ${a}`:"Current weather");o({location:a,latitude:d,longitude:u,units:h}).then(e=>{if(!e){s.textContent=`${i}: unavailable`,n||(t.dataset.label=i);return}const a=Math.round(e.temperature),o=[];e.locationName?o.push(`${e.locationName}: ${a}${e.unitSymbol}`):o.push(`${a}${e.unitSymbol}`),e.description&&o.push(e.description),s.textContent=o.join(", "),n||(t.dataset.label=e.locationName?`${e.locationName} weather`:"Current weather")}).catch(e=>{console.warn("Weather update failed",e),s.textContent=`${i}: unavailable`,n||(t.dataset.label=i)})};typeof window!="undefined"&&(window.weatherModule=window.weatherModule||{},window.weatherModule.initializeWeatherMessage=i)})()})()