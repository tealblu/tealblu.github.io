(()=>{(()=>{const e="coffeeModuleState",t=()=>{if(typeof window=="undefined")return null;try{return window.localStorage}catch(e){console.warn("Coffee tracker localStorage access failed",e)}return null},o=()=>{const n=t();if(!n)return null;try{const t=n.getItem(e);if(typeof t!="string"||t.length===0)return null;const s=JSON.parse(t);if(!s||typeof s!="object")return null;const{date:o,count:i}=s;return typeof o!="string"||!Number.isFinite(i)?null:{date:o,count:Math.round(i)}}catch(e){console.warn("Coffee tracker state parse failed",e)}return null},i=n=>{const s=t();if(!s)return;try{s.setItem(e,JSON.stringify(n))}catch(e){console.warn("Coffee tracker state persist failed",e)}},n=e=>String(e).padStart(2,"0"),a=()=>{const e=new Date;return`${e.getFullYear()}-${n(e.getMonth()+1)}-${n(e.getDate())}`},s=(e,t)=>{if(typeof e=="number"&&Number.isFinite(e))return e|0;if(typeof e=="string"&&e.trim().length>0){const t=Number.parseInt(e.trim(),10);if(Number.isFinite(t))return t}return t},r=(e,t)=>{const n=t-e+1;return n<=0?e:e+Math.floor(Math.random()*n)},c=(e,t)=>{const s=a(),n=o();if(n&&n.date===s&&n.count>=e&&n.count<=t)return n.count;const c=r(e,t);return i({date:s,count:c}),c},l=e=>{if(typeof e!="string"||e.trim().length===0)return"Coffee tracker";const t=e.trim();return`${t.charAt(0).toUpperCase()}${t.slice(1)} tracker`},d=()=>{if(typeof document=="undefined")return;const e=document.getElementById("nav-message-rotator");if(!e||e.dataset.coffeeEnabled!=="true")return;if(e.querySelector('[data-coffee-message="true"]'))return;const d=Array.from(e.querySelectorAll(".nav-module-message")),t=document.createElement("span");t.className="nav-module-message",t.dataset.index=String(d.length),t.dataset.coffeeMessage="true";const n=typeof e.dataset.coffeeLabel=="string"&&e.dataset.coffeeLabel.trim().length>0?e.dataset.coffeeLabel.trim():"";if(n){t.dataset.label=n;const e=document.createElement("span");e.className="nav-module-label",e.textContent=n,t.appendChild(e)}const o=document.createElement("span");o.className="nav-module-text",o.textContent="Tracking coffeeâ€¦",t.appendChild(o),d.length||t.classList.add("is-active"),e.appendChild(t);const i=Math.max(0,s(e.dataset.coffeeMin,0)),h=Math.max(i,s(e.dataset.coffeeMax,Math.max(i,5))),m=typeof e.dataset.coffeeUnitSingular=="string"&&e.dataset.coffeeUnitSingular.trim().length>0?e.dataset.coffeeUnitSingular.trim():"cup",f=typeof e.dataset.coffeeUnitPlural=="string"&&e.dataset.coffeeUnitPlural.trim().length>0?e.dataset.coffeeUnitPlural.trim():"cups",a=typeof e.dataset.coffeeBeverage=="string"&&e.dataset.coffeeBeverage.trim().length>0?e.dataset.coffeeBeverage.trim():"coffee",u=typeof e.dataset.coffeeVerb=="string"&&e.dataset.coffeeVerb.trim().length>0?e.dataset.coffeeVerb.trim():"consumed today",r=n||l(a);try{const s=c(i,h),l=s===1?m:f,e=[`${s} ${l}`];a&&e.push(`of ${a}`),u&&e.push(u),o.textContent=e.join(" "),n||(t.dataset.label=r)}catch(e){console.warn("Coffee tracker update failed",e),o.textContent=`${r}: unavailable`,n||(t.dataset.label=r)}};typeof window!="undefined"&&(window.coffeeModule=window.coffeeModule||{},window.coffeeModule.initializeCoffeeMessage=d)})()})()